<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script type='text/javascript'
      src='http://code.jquery.com/jquery-1.10.1.js'></script>
    <link rel="stylesheet" type="text/css"
      href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <script type='text/javascript'
        src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <title>Live Objects Rule Engine</title>
    <style type="text/css">
        .btn {
        /* background-color: DodgerBlue; /* Blue background */ */
        border: none; /* Remove borders */
        color: white; /* White text */
         /* Some padding */
        font-size: 16px; /* Set a font size */
        cursor: pointer; /* Mouse pointer on hover */
    }
    .btn:hover {
      background-color: RoyalBlue;
    }
    .formContainer{margin-left: 220px ;}


    </style>
  </head>
  <body>
<div class="container">
<br/>
  <form id="formAPI" name="formAPI">
    <div class="form-inline">
      <label for="inputName3" class="col-sm-2 col-form-label">Enter API-KEY</label>
      <div class="col-sm-14">
        <input type="text" class="form-control" id="inputApi" placeholder="XXXXXXXXXXXX">
        <button type="button" class="btn btn-primary" onclick="submit_api()">Continue</button>
              </div>
    </div>
  </form>
  <small class="text-muted">Mandatory roles for your API Key : DATA_PROCESSING_R, DATA_PROCESSING_W,DEVICE_R,DEVICE_W,API_KEY_R, DATA_R</small>
  <hr>
  <H2>Create an HTTP Push</H2>
<div id="secondForm" class="">
  <form id="form1" name="form1">
    <div class=" form-inline row">
      <label for="inputName3" class="col-sm-2 col-form-label">Enter name</label>
      <div class="col-md-2" >
        <input type="text" class="form-control" id="pushName" name="pushName" placeholder="Ex:firstPush">
      </div>
        <div id="name-error" class=""></div>
    </div>

    <div class="form-inline row">
      <label for="inputName3" class="col-sm-2 col-form-label">Enter url</label>
      <div class="col-md-2" id="api">
        <input type="text" class="form-control" id="url" name="event" placeholder="Ex: https://maker.ifttt.com/trigger/test/with/key/">
      </div>
      <div id="url-error" class=""></div>
    </div>
    <div class="formContain">
    <div class="form-inline row rowDuplicat">
      <label for="inputName3" class="col-sm-2 col-form-label">Add header</label>
      <div class="col-md-8" >
        <input type="text" class="form-control" id="head1" name="event" placeholder="Accept">
        <input type="text" class="form-control" id="head2" name="event" placeholder="application/json">

        &nbsp;&nbsp;
        <input type="button"  class="btn btn-primary addR " value="+"  />
        <input type = "button"  class="btn btn-danger removeR " value="-" />
      </div>
      </div>
      <div id="header-error" class=""></div>
      </div>
    </div>
    <fieldset class="form-group row">
      <legend class="col-form-legend col-sm-2">Content</legend>

        <div class="formContainer">
          <div  class="row form-inline rowDuplicate">
            <div class="col-md-8 " id="rangee">
              <input type="text" class="form-control inputVal" name="free" placeholder="Ex: value1">
                  &nbsp;&nbsp;
                <select class="form-control condi"  id="condi0" name="condi" onchange="showData(0)" >

                </select>
                <select class="form-control newSel" id="sel0" name="newSel"  style="display:none;">

                </select>
                &nbsp;&nbsp;
                <input type="button"  class="btn btn-primary addRow " value="+"  />
                <input type = "button"  class="btn btn-danger removeRow " value="-" />
              </div>
            </div>
            <div id="rangee-error" class=""></div>
        </div>


      </fieldset>
      <div class="form-group row">
        <div class="offset-sm-2 col-sm-10">
          <button type="button" class="btn btn-primary" onclick="submit_by_id()">Push</button>
        </div>
      </div>
  </form>
    </div>
    <br>
    <H2>List your rules</H2>
    <div class="row">
  		<div class="col-md-9">
          <table class="table table-striped table-bordered"
            id="event_rule">
            <thead id = "tab">
                <tr>
                <th>HP name</th>
                <th id="act">Button to delete the rule</th>
                </tr>
            </thead>
            <tbody id="bod">
            </tbody>
          </table>
  		</div>
      <br><br>
	   </div>
    </div>
    <script src="script.js"></script>
    <script type="text/javascript">
    $(window).load(function(){
    $(function () {
        $("table#event_rule").on("click", ".remove", function () {
           var delRow =this.parentNode.id;
          var page = 'https://liveobjects.orange-business.com/api/v0/event2action/actionPolicies/'+delRow+'';
          var xmlhttp = new XMLHttpRequest();
          xmlhttp.open("DELETE", page, true);
          xmlhttp.setRequestHeader('Accept', 'application/json');
          xmlhttp.setRequestHeader('Content-type', 'application/json');
          xmlhttp.setRequestHeader('X-API-KEY', kAPI);
          xmlhttp.send();
          xmlhttp.onreadystatechange = function(data) {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            console.log("Deletion successfull");

          }
        }
          $(this).closest('tr').remove();
        });
    });
    $(function () {
        $(".show_tip").tooltip({
            container: 'body'
        });
    });
    $(document).click(function () {
        $('.tooltip').remove();
        $('[title]').tooltip();
      });
  });

  //duplicate the row
  $(function(){
var rowItem = $(".rowDuplicate");

$(".formContainer").on("click", ".addRow", function(){
    var newItem = rowItem.clone(),
        rowIndex = $(".rowDuplicate").length;
        var g = 'condi'+(rowIndex-1);
    $(":input", newItem).each(function(c, obj){
        $(obj).attr("id", $(obj).attr("name") + rowIndex);
        // $(obj).setAttribute("onchange", "showData("+rowIndex+")");
          // $(obj).attr("onchange", $(obj).attr("showData("+rowIndex+")") );
          // $("#condi0").setAttribute("onchange", "showData("+rowIndex+")");
          // $('condi'+rowIndex).attr('onchange',null).change(function() { showData(rowIndex); });

});



    //$(this).parent().parent().after(newItem); // adds just after the current line
   $(".formContainer").append(newItem); // adds At the end of the container
   console.log(rowIndex);
   document.getElementsByClassName('condi')[rowIndex-1].setAttribute("onchange" , "showData("+ (rowIndex) + ")");
})
.on("click", ".removeRow", function(){
    if($(".rowDuplicate").length > 1){
        $(this).parents(".rowDuplicate").remove();
    }
});

});

//***///
$(function(){
var rowItem = $(".rowDuplicat");

$(".formContain").on("click", ".addR", function(){
    var newItem = rowItem.clone(),
        rowIndex = $(".rowDuplicat").length;
    $(":input", newItem).each(function(c, obj){
        $(obj).attr("id", $(obj).attr("name") + rowIndex);

});



    //$(this).parent().parent().after(newItem); // adds just after the current line
   $(".formContain").append(newItem); // adds At the end of the container
   })
.on("click", ".removeR", function(){
    if($(".rowDuplicat").length > 1){
        $(this).parents(".rowDuplicat").remove();
    }
});

});

    </script>
  </body>
</html>
